const fs = require('fs')
const workspace = require('./workspace')
const workspace2 = require('./workspace2')

code = fs.readFileSync('./script2-cleaned.js', {encoding: 'utf8'})

function process() {
    skipList = {}
    while (code.match(/workspace\['[A-Za-z0-9]+'\]/) != null) {
        match = code.match(/workspace\['[A-Za-z0-9]+'\]/)[0]
        val = eval(match)
        if ('string' == typeof val) {
            code = code.replace(match, `'${val}'`)
        } else {
            temp = 'v'+Math.random().toString(36).slice(2)
            skipList[temp] = match
            code = code.replace(match, `${temp}`)
        }
        if (code.match(/workspace\['[A-Za-z0-9]+'\]/) == null) {
            console.log('part 1 done')
            break
        }
    }
    for (const skip in skipList) {
        if (Object.hasOwnProperty.call(skipList, skip)) {
            const original = skipList[skip];
            code = code.replaceAll(skip, `${original}`)
        }
    }
    console.log('part 2 done')
    skipList = {}
    while (code.match(/workspace2\['[A-Za-z0-9]+'\]/) != null) {
        match = code.match(/workspace2\['[A-Za-z0-9]+'\]/)[0]
        val = eval(match)
        if ('string' == typeof val) {
            code = code.replace(match, `'${val}'`)
        } else {
            temp = 'v'+Math.random().toString(36).slice(2)
            skipList[temp] = match
            code = code.replace(match, `${temp}`)
        }
        if (code.match(/workspace2\['[A-Za-z0-9]+'\]/) == null) {
            console.log('part 3 done')
            break
        }
    }
    for (const skip in skipList) {
        if (Object.hasOwnProperty.call(skipList, skip)) {
            const original = skipList[skip];
            code = code.replaceAll(skip, `${original}`)
        }
    }
    console.log('part 4 done')
}

process()

fs.writeFileSync('./output.js', code, { encoding: 'utf8' })
